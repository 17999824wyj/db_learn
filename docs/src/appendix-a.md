# 附录 A：对 .dmp 文件的探索

可能有些同学发现，在课程资料包的 `Seamart数据集` 目录内，有一个名为 `seamart.dmp` 的文件。这个东西是什么呢？

## 某些定义下的 .dmp

直接问 bing，得到很多解释，都说是 `.dmp 文件` 是 windows 系统下的转储文件，用于记录系统崩溃时的内存信息，便于系统管理员进行故障排查。

那问题来了，windows 系统下的转储文件，为什么放在了数据集内呢？

## 根据程序名猜测

观察 `Server/bin` 目录下的内容，发现有一个可执行文件，叫做 `sys_dump.exe`，从名字上看，这个程序可能应该是用来生成 `.dmp` 文件的。

官网查这个程序，发现它是一个用来进行数据库备份的程序，那么可以猜测，`seamart.dmp` 文件就是 `sys_dump.exe` 程序生成的数据库备份文件。

## 确认

在官网上了解到，`sys_restore.exe` 是金仓提供的用来恢复数据库的程序，那么就使用此程序，加载 `seamart.dmp` 文件，看看是否能够成功恢复数据库。

我用的命令：`.\sys_restore.exe -Usystem -dseamart seamart.dmp的路径`。

经过验证，确实能够恢复部分数据，但过程中会产生大量的报错...

## 现存问题

恢复过程中会出现报错，不知道是不是导致了恢复失败。(应该算是失败了，毕竟虽然表和数据库的结构出来了，但数据是没有的)

## 进一步猜测

这个是后续我的思考：

观察 `Server/bin` 的内容，发现有一个 `sys_dumpall.exe` 的东西，猜测这个程序应该也是用来生成 `.dmp` 文件的。那么这就让人意识到一个问题，`sys_dump.exe` 和 `sys_dumpall.exe` 生成的 `.dmp` 文件，可能是不一样的。

1. 观察不用 dmp 文件，而是直接用 `seamart.sql` 恢复的数据库，发现其结构和内置的 `test` 数据库和 `kingbase` 数据库的结构类似，所以有一个疑问：
   - 是不是 `sys_dump.exe` 是用来备份 `结构+数据` 的，而 `sys_dumpall.exe` 是用来备份某些特定数据库的 `结构+数据+该数据库的系统配置` 的？
2. 如果说该问题成立，那么可能是 `在导出数据时`，使用的程序问题，导致的恢复过程中一大堆报错。这个问题可能不是我们得到资料包的人能够解决的
3. 如果该问题不成立，那么可能还是 `在导入数据时`，使用的程序问题，导致的恢复过程中一大堆报错。那么就说明可能是我的操作方法不对，但是懒得验证了，毕竟验证一次挺麻烦的，需要 `删掉数据库 -> 重新导入数据(5min以上) -> 观察日志继续推测 -> 迭代...`。一套流程下来估计得快 10min 了。

而且，还不能排除以下情况的影响：

- 数据库名字是否有影响？
  - 凭我的验证体验来看，应该是没有影响的，因为报错都一样。
- 数据库内的系统环境配置是否有影响？
  - 这个我尝试照着一篇博客去做，但是失败了，好像还把数据库给干崩了，只能无奈重装... 博客链接找不到了，反正最下面是说让配置数据库的系统搜索路径，然后 `alter` 执行一下，但是我没有成功还把数据库干崩了(恢复到之前的环境死活回不去了...)。
- 数据库是否恢复前需要先建好表格和视图？
  - 我尝试过不恢复和恢复，应该都不太行，但 `控制变量法` 验证时，变量太多且可能存在未知变量，故难以确保我验证的准确性。

## 解决方案

希望有其它大佬能够给出解决方案，或者给出一些猜测吧。

毕竟对金仓还是很不熟的，不敢妄下断言，只能说有所猜测吧。
